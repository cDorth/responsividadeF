{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MySphere - Eventos</title>
    <link rel="stylesheet" href="{% static 'feed/css/style.css' %}" />
    <link rel="stylesheet" href="{% static 'eventos/css/eventos.css' %}" />
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <div class="logo">
                    <h1>{{user.tenant.nome}}</h1>
                </div>
            </div>
            <div class="header-right">
                {% if user.is_staff %}
                    <a href="{% url 'dashboard_staff' %}" class="btn-staff">Staff</a>
                {% endif %}
                <div class="user-info">
                    {% if user.foto %}
                    <img src="{{ user.foto.url }}" alt="{{ user.username }}" class="user-avatar-small" />
                    {% else %}
                    <div class="user-avatar-small default-avatar">
                        {{ user.username|slice:":1"|upper }}
                    </div>
                    {% endif %}
                    <a href="{% url 'home' %}" style="text-decoration: none;"><span>{{ user.username }}</span></a>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Sidebar - Profile -->
            <aside class="sidebar-left">
                <div class="profile-card">
                    <div class="profile-header">
                        {% if user.foto %}
                        <img src="{{ user.foto.url }}" alt="{{ user.username }}" class="profile-avatar" />
                        {% else %}
                        <div class="profile-avatar default-avatar-large">
                            {{ user.username|slice:":1"|upper }}
                        </div>
                        {% endif %}
                        <h3>{{ user.get_full_name|default:user.username }}</h3>
                        <p class="profile-username">@{{ user.username }}</p>
                    </div>
                    <div class="profile-stats">
                        <div class="stat">
                            <span class="stat-number">{{ user.posts_authored.count }}</span>
                            <span class="stat-label">Post</span>
                        </div>
                        <div class="stat">
                            <span class="stat-number">235</span>
                            <span class="stat-label">Following</span>
                        </div>
                        <div class="stat">
                            <span class="stat-number">2.3k</span>
                            <span class="stat-label">Follower</span>
                        </div>
                    </div>
                </div>

                <nav class="sidebar-menu">
                    <a href="{% url 'feed:feed' %}" class="menu-item">
                        <span class="icon">üìÖ</span> Feed
                    </a>
                    <a href="{% url 'home' %}" class="menu-item">
                        <span class="icon">üë§</span> Perfil
                    </a>
                    <a href="{% url 'game_home' %}" class="menu-item">
                        <span class="icon">üèÖ</span> Gamifica√ß√£o
                    </a>
                    <a href="#" class="menu-item">
                        <span class="icon">üèÜ</span> Conquistas
                    </a>
                    <a href="{% url 'listar_eventos_compacto' %}" class="menu-item active">
                        <span class="icon">üóìÔ∏è</span> Eventos
                    </a>
                    <a href="{% url 'chat' %}" class="menu-item">
                        <span class="icon">üí¨</span> Chat
                    </a>
                </nav>

                <div class="pages-section">
                    <h4>PAGES YOU LIKE</h4>
                    <div class="page-item">
                        <div class="page-icon">UI</div>
                        <span>UI/UX Community</span>
                    </div>
                    <div class="page-item">
                        <div class="page-icon">WD</div>
                        <span>Web Designer</span>
                    </div>
                    <div class="page-item">
                        <div class="page-icon">DR</div>
                        <span>Dribbble Community</span>
                    </div>
                    <div class="page-item">
                        <div class="page-icon">BE</div>
                        <span>Behance</span>
                    </div>
                    <a href="#" class="view-all">View All</a>
                </div>
            </aside>

            <!-- Center Content - Events -->
            <main class="feed-center">
                <div class="events-header">
                    <div class="events-title">
                        <h2>Eventos</h2>
                        <p class="subtitle">Descubra e participe dos pr√≥ximos eventos</p>
                    </div>
                    {% if pode_gerenciar %}
                    <a href="{% url 'criar_evento' %}" class="btn-create-event">
                        <span class="plus-icon">+</span> Criar Evento
                    </a>
                    {% endif %}
                </div>

                <!-- Events Grid -->
                <div class="events-grid">
                    {% for evento in eventos %}
                    <div class="event-card" onclick="openEventModal({{ evento.id }})">
                        <div class="event-image">
                            {% if evento.foto %}
                            <img src="{{ evento.foto.url }}" alt="{{ evento.titulo }}" />
                            {% else %}
                            <div class="event-placeholder">
                                <span class="calendar-icon">üìÖ</span>
                            </div>
                            {% endif %}
                            <div class="event-date-badge">
                                <div class="badge-day">{{ evento.inicio|date:"d" }}</div>
                                <div class="badge-month">{{ evento.inicio|date:"M" }}</div>
                            </div>
                        </div>
                        <div class="event-content">
                            <h3 class="event-title">{{ evento.titulo }}</h3>
                            <div class="event-info-row">
                                <span class="event-time">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <polyline points="12 6 12 12 16 14"></polyline>
                                    </svg>
                                    {{ evento.inicio|date:"H:i" }}
                                </span>
                                <span class="event-duration">
                                    {{ evento.inicio|date:"d/m/Y" }}
                                </span>
                            </div>
                            <p class="event-description">{{ evento.descricao|truncatewords:15|default:"Sem descri√ß√£o dispon√≠vel" }}</p>
                            <div class="event-footer">
                                <div class="event-creator">
                                    {% if evento.criado_por.foto %}
                                    <img src="{{ evento.criado_por.foto.url }}" alt="{{ evento.criado_por.username }}" class="creator-avatar" />
                                    {% else %}
                                    <div class="creator-avatar default-creator-avatar">
                                        {{ evento.criado_por.username|slice:":1"|upper }}
                                    </div>
                                    {% endif %}
                                    <span>{{ evento.criado_por.get_full_name|default:evento.criado_por.username }}</span>
                                </div>
                                {% if pode_gerenciar %}
                                <div class="event-actions">
                                    <a href="{% url 'editar_evento' evento.id %}" class="btn-icon btn-edit" onclick="event.stopPropagation()" title="Editar">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                        </svg>
                                    </a>
                                    <form action="{% url 'excluir_evento' evento.id %}" method="post" style="display: inline;" onsubmit="return confirm('Tem certeza que deseja excluir este evento?');">
                                        {% csrf_token %}
                                        <button type="submit" class="btn-icon btn-delete" onclick="event.stopPropagation()" title="Excluir">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="3 6 5 6 21 6"></polyline>
                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                            </svg>
                                        </button>
                                    </form>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="empty-state">
                        <div class="empty-icon">üìÖ</div>
                        <h3>Nenhum evento encontrado</h3>
                        <p>N√£o h√° eventos cadastrados no momento.</p>
                        {% if pode_gerenciar %}
                        <a href="{% url 'criar_evento' %}" class="btn-create-event">Criar Primeiro Evento</a>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </main>

            <!-- Right Sidebar - Upcoming Events -->
            <aside class="sidebar-right">
                <div class="upcoming-section">
                    <h3>Pr√≥ximos Eventos</h3>
                    {% for evento in eventos|slice:":3" %}
                    <div class="upcoming-event" onclick="openEventModal({{ evento.id }})">
                        <div class="upcoming-date">
                            <div class="date-day">{{ evento.inicio|date:"d" }}</div>
                            <div class="date-month">{{ evento.inicio|date:"M" }}</div>
                        </div>
                        <div class="upcoming-info">
                            <h4>{{ evento.titulo|truncatewords:5 }}</h4>
                            <p>{{ evento.inicio|date:"H:i" }}</p>
                        </div>
                    </div>
                    {% empty %}
                    <p class="no-upcoming">Nenhum evento pr√≥ximo</p>
                    {% endfor %}
                </div>
            </aside>
        </div>
    </div>

    <!-- Bottom Navigation for Mobile -->
    <nav class="bottom-nav" role="navigation" aria-label="Mobile navigation">
        <div class="bottom-nav-container">
            <a href="{% url 'feed:feed' %}" class="bottom-nav-item" aria-label="Feed">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                </svg>
                <span>Feed</span>
            </a>
            <a href="{% url 'home' %}" class="bottom-nav-item" aria-label="Perfil">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
                <span>Perfil</span>
            </a>
            <a href="{% url 'game_home' %}" class="bottom-nav-item" aria-label="Gamifica√ß√£o">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span>Gamif.</span>
            </a>
            <a href="{% url 'listar_eventos_compacto' %}" class="bottom-nav-item active" aria-label="Eventos" aria-current="page">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
                <span>Eventos</span>
            </a>
            <a href="{% url 'chat' %}" class="bottom-nav-item" aria-label="Chat">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                </svg>
                <span>Chat</span>
            </a>
        </div>
    </nav>

    <!-- Event Detail Modal -->
    <div id="eventModal" class="modal">
        <div class="modal-overlay" onclick="closeEventModal()"></div>
        <div class="modal-content">
            <button class="modal-close" onclick="closeEventModal()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <div id="modalBody">
                <!-- Content will be dynamically loaded -->
            </div>
        </div>
    </div>

    <script>
        const eventsData = {
            {% for evento in eventos %}
            {{ evento.id }}: {
                id: {{ evento.id }},
                titulo: "{{ evento.titulo|escapejs }}",
                descricao: "{{ evento.descricao|escapejs }}",
                inicio: "{{ evento.inicio|date:'d/m/Y H:i' }}",
                fim: "{{ evento.fim|date:'d/m/Y H:i' }}",
                {% if evento.foto %}foto: "{{ evento.foto.url }}",{% endif %}
                criador: "{{ evento.criado_por.get_full_name|default:evento.criado_por.username|escapejs }}",
                tenant: "{{ evento.tenant.nome|escapejs }}"
            }{% if not forloop.last %},{% endif %}
            {% endfor %}
        };

        function openEventModal(eventId) {
            const event = eventsData[eventId];
            const modal = document.getElementById('eventModal');
            const modalBody = document.getElementById('modalBody');

            let content = `
                <div class="modal-header">
                    ${event.foto ? `<img src="${event.foto}" alt="${event.titulo}" class="modal-image" />` : ''}
                    <h2>${event.titulo}</h2>
                </div>
                <div class="modal-details">
                    <div class="detail-row">
                        <div class="detail-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            In√≠cio
                        </div>
                        <div class="detail-value">${event.inicio}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            T√©rmino
                        </div>
                        <div class="detail-value">${event.fim}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            Criado por
                        </div>
                        <div class="detail-value">${event.criador}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                <polyline points="9 22 9 12 15 12 15 22"></polyline>
                            </svg>
                            Organiza√ß√£o
                        </div>
                        <div class="detail-value">${event.tenant}</div>
                    </div>
                    ${event.descricao ? `
                    <div class="detail-description">
                        <h3>Descri√ß√£o</h3>
                        <p>${event.descricao}</p>
                    </div>
                    ` : ''}
                </div>
            `;

            modalBody.innerHTML = content;
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeEventModal() {
            const modal = document.getElementById('eventModal');
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }

        // Close modal on ESC key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeEventModal();
            }
        });
    </script>
</body>
</html>